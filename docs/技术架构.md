# Electron 密码管理器项目配置

## 项目信息
- **项目名称**: Password Manager
- **版本**: 1.0.0
- **技术栈**: Electron + React + TypeScript
- **开发平台**: 跨平台 (Windows, macOS, Linux)
- **目标用户**: 个人密码管理需求用户

## 技术栈配置

### 前端框架
- **React 18.2.0**: 现代化的用户界面库
- **TypeScript 5.2.2**: 类型安全的JavaScript超集
- **Ant Design 5.11.5**: 企业级UI组件库
- **React Router 6.18.0**: 单页应用路由管理

### 后端/桌面端
- **Electron 27.1.3**: 跨平台桌面应用框架
- **Node.js 18.0+**: JavaScript运行时环境

### 数据存储
- **better-sqlite3**: 高性能 SQLite 数据库（本地持久化）

### 安全加密
- **Node.js crypto**: 原生加密模块（PBKDF2 + AES-256-CBC，字段级加密）
- **archiver-zip-encrypted**: 加密 ZIP 备份包导出

### 生物识别
- 暂不支持，规划后续版本

## 项目结构

```
password-manager/
├── src/
│   ├── main/                 # Electron主进程
│   │   ├── main.ts          # 主进程入口
│   │   ├── database/        # 数据库操作
│   │   ├── services/        # 域服务（Password/Group/Note/Settings/Backup/Integrity）
│   │   └── utils/           # 工具函数
│   ├── renderer/            # React渲染进程
│   │   ├── components/      # React组件
│   │   ├── pages/           # 页面组件
│   │   ├── hooks/           # 自定义 Hooks（usePasswords/useGroups/useNotes/useBackup/useIntegrity）
│   │   ├── utils/           # 工具函数
│   │   ├── types/           # TypeScript类型定义
│   │   ├── index.tsx        # 渲染进程入口
│   │   └── index.html       # HTML模板
│   └── shared/              # 共享代码
│       ├── types.ts         # 共享类型定义
│       └── utils/           # 共享工具函数
├── assets/                  # 静态资源
│   └── icons/               # 应用图标
├── dist/                    # 构建输出
├── release/                 # 发布包
├── package.json             # 项目配置
├── tsconfig.json            # TypeScript配置
├── webpack.renderer.config.js # 渲染进程打包配置
├── webpack.main.config.js   # 主进程打包配置
├── jest.config.js           # 测试配置
├── .eslintrc.js            # ESLint配置
├── .prettierrc             # Prettier配置
└── .gitignore              # Git忽略文件
```

## 开发环境配置

### 必需软件
1. **Node.js 18.0+**: JavaScript运行时
2. **npm 或 yarn**: 包管理器
3. **VS Code**: 推荐的开发IDE

### VS Code 推荐插件
- ES7+ React/Redux/React-Native snippets
- TypeScript Importer
- Prettier - Code formatter
- ESLint
- Auto Rename Tag
- Bracket Pair Colorizer
- GitLens

## 依赖管理

### 核心依赖
```json
{
  "electron": "^27.1.3",
  "react": "^18.2.0",
  "react-dom": "^18.2.0",
  "antd": "^5.11.5",
  "better-sqlite3": "^9.2.2",
  "crypto-js": "^4.2.0",
  "electron-store": "^8.1.0"
}
```

### 开发依赖
```json
{
  "typescript": "^5.2.2",
  "webpack": "^5.89.0",
  "jest": "^29.7.0",
  "eslint": "^8.54.0",
  "prettier": "^3.1.0"
}
```

## 安全配置

### 数据加密
- 字段级加密：PBKDF2 派生密钥 + AES-256-CBC 加密 `passwords.password`、`password_history.old/new_password`、`secure_records.content_ciphertext`
- 备份包：支持加密 ZIP 导出（需设置导出密码）

### 应用安全
- Electron安全最佳实践
- 内容安全策略(CSP)
- 禁用Node.js集成在渲染进程
- 启用上下文隔离

## 构建配置

### 开发环境
```bash
npm run dev          # 启动开发服务器
npm run dev:renderer # 仅启动渲染进程开发服务器
npm run dev:main     # 仅监听主进程文件变化
```

### 生产构建
```bash
npm run build        # 构建所有代码
npm run build:renderer # 构建渲染进程
npm run build:main   # 构建主进程
```

### 打包发布
```bash
npm run dist         # 构建并打包所有平台
npm run dist:mac     # 打包macOS版本
npm run dist:win     # 打包Windows版本
npm run dist:linux   # 打包Linux版本
```

## 测试配置

### 单元测试
- Jest + React Testing Library
- 覆盖率报告
- 监听模式

### 代码质量
- ESLint + TypeScript规则
- Prettier代码格式化
- Git hooks集成

## 部署配置

### 自动更新
- electron-updater集成
- GitHub Releases支持
- 增量更新

### 代码签名
- macOS代码签名
- Windows代码签名
- 公证服务

## 环境变量

### 开发环境
```env
NODE_ENV=development
ELECTRON_IS_DEV=1
```

### 生产环境
```env
NODE_ENV=production
ELECTRON_IS_DEV=0
```

## 性能优化

### 构建优化
- Webpack代码分割
- Tree shaking
- 压缩优化

### 运行时优化
- React.memo优化
- 虚拟滚动
- 懒加载

## 调试配置

### 主进程调试
- VS Code调试配置
- Chrome DevTools
- 控制台日志

### 渲染进程调试
- Chrome DevTools
- React Developer Tools
- Redux DevTools

## 版本管理

### 语义化版本
- 主版本号：不兼容的API修改
- 次版本号：向下兼容的功能性新增
- 修订号：向下兼容的问题修正

### 发布流程
1. 更新版本号
2. 更新CHANGELOG
3. 创建Git标签
4. 构建发布包
5. 上传到发布平台

## 新增前端需求开发样例（密码过期提醒）

目标：在主界面新增一个“即将过期的密码”模块，展示在未来 N 天内即将过期的密码条目。此样例覆盖类型定义、IPC、preload、Hook、组件与集成，遵循“Renderer → IPC → Main → Data”分层。

### 步骤 1：更新共享类型（`src/shared/types.ts`）
在共享类型中为密码条目增加过期日期字段，统一渲染层与主进程的数据结构：

```ts
export interface PasswordItem {
  id?: number;
  title: string;
  username: string;
  password?: string | null;
  url?: string | null;
  notes?: string | null;
  group_id?: number | null;
  created_at?: string;
  updated_at?: string;
  expiration_date?: string;
}
```

说明：`expiration_date` 采用 ISO 字符串（例如 `2025-12-31T00:00:00.000Z`）。

### 步骤 2：主进程新增 IPC（`src/main/ipc/passwords.ts`）
在密码域的 IPC 模块中新增 `get-expiring-passwords`，按“动宾结构”命名，并通过服务层读取数据：

```ts
import { ipcMain } from 'electron';
import { PasswordService } from '../services/PasswordService';

const passwordService = new PasswordService();

ipcMain.handle('get-expiring-passwords', async (_, days: number) => {
  const list = await passwordService.getPasswords();
  const now = new Date().getTime();
  const limit = days * 24 * 60 * 60 * 1000;
  return list.filter(p => {
    if (!p.expiration_date) return false;
    const exp = new Date(p.expiration_date).getTime();
    return exp - now <= limit && exp >= now;
  });
});
```

说明：仅返回当前时间至 `days` 天内过期的条目，忽略已过期或未设置过期日期的条目。

### 步骤 3：在 `preload.ts` 暴露一致接口（`src/main/preload.ts`）
所有新 IPC 必须通过 `preload.ts` 暴露到渲染层，统一签名：

```ts
import { contextBridge, ipcRenderer } from 'electron';
import type { PasswordItem } from '../shared/types';

export interface ElectronAPI {
  getExpiringPasswords: (days: number) => Promise<PasswordItem[]>;
}

const electronAPI: ElectronAPI = {
  getExpiringPasswords: (days) => ipcRenderer.invoke('get-expiring-passwords', days),
};

contextBridge.exposeInMainWorld('electronAPI', electronAPI);
```

说明：遵循上下文隔离与安全暴露规范，禁止在渲染层直接使用 `ipcRenderer`。

### 步骤 4：创建 Hook（`src/renderer/hooks/useExpiringPasswords.ts`）
以 Hook 统一数据加载与状态管理，提升组件内聚性：

```ts
import { useState, useCallback } from 'react';
import type { PasswordItem } from '../../shared/types';

export function useExpiringPasswords() {
  const [expiringPasswords, setExpiringPasswords] = useState<PasswordItem[]>([]);
  const [loading, setLoading] = useState(false);

  const loadExpiringPasswords = useCallback(async (days: number) => {
    setLoading(true);
    try {
      const data = await window.electronAPI.getExpiringPasswords(days);
      setExpiringPasswords(data);
    } finally {
      setLoading(false);
    }
  }, []);

  return { expiringPasswords, loading, loadExpiringPasswords };
}
```

### 步骤 5：新增组件（`src/renderer/components/ExpiringPasswords.tsx`）
在主界面加入卡片列表展示，使用 Ant Design：

```tsx
import { useEffect } from 'react';
import { Card, List, Typography } from 'antd';
import { useExpiringPasswords } from '../hooks/useExpiringPasswords';

export function ExpiringPasswords() {
  const { expiringPasswords, loading, loadExpiringPasswords } = useExpiringPasswords();

  useEffect(() => {
    loadExpiringPasswords(7);
  }, [loadExpiringPasswords]);

  if (loading) return <div>加载中...</div>;

  return (
    <Card title="即将过期的密码">
      {expiringPasswords.length === 0 ? (
        <Typography.Text>没有即将过期的密码</Typography.Text>
      ) : (
        <List
          dataSource={expiringPasswords}
          renderItem={(item) => (
            <List.Item>
              <List.Item.Meta
                title={item.title}
                description={`过期时间：${item.expiration_date}`}
              />
            </List.Item>
          )}
        />
      )}
    </Card>
  );
}
```

### 步骤 6：集成到主界面（`src/renderer/App.tsx`）
将组件集成到主页面或对应布局区域：

```tsx
import { ExpiringPasswords } from './components/ExpiringPasswords';

export default function App() {
  return (
    <div className="app">
      <ExpiringPasswords />
    </div>
  );
}
```

### 验证与规范
- 运行 `npm run lint`，确保代码质量通过；随后执行 `npm run build` 验证构建。
- IPC 渠道命名采用动宾结构，参数与返回值结构固定，并在 `preload.ts` 暴露一致签名。
- 渲染层禁止直接访问主进程与数据库，统一通过 `preload.ts` 暴露的 API 交互。
- 公共接口与组件需补充注释，保持注释与实现一致。
